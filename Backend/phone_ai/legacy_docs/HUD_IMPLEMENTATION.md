# 🎨 HUD 实现说明

## 已实现的 HUD 元素

根据 `Aim.md` 的需求，我们已经实现了三个核心 HUD 元素：

### 1. 教练胶囊（顶部）

**位置**：屏幕最上方中央
**样式**：半透明黑色胶囊，白色文字，带描边
**行为**：
- 始终显示（即使没有数据也显示默认提示）
- 正常状态：显示任务描述（如"跟随引导，向右平移"）
- 错误状态：变红并闪烁（如"稳住！太快了！"）
- 完成状态：变绿显示"🎉 任务完成！"

**实现位置**：`ShootingAdvisorView.tsx` - `CoachCapsule` 组件

### 2. 方向指示器（右侧边缘）

**位置**：屏幕右边缘中央
**样式**：三个白色 `>>>` 符号，带呼吸动效
**行为**：
- 录制时显示
- 正确方向：白色，微微跳动（animate-pulse）
- 错误方向：红色，闪烁（animate-bounce）
- 根据任务类型显示不同方向：`>>>`（右移）、`<<<`（左移）、`↓↓↓`（推进）、`↑↑↑`（拉远）

**实现位置**：`ShootingAdvisorView.tsx` - `DirectionChevrons` 组件

### 3. 平衡水平仪（底部）

**位置**：屏幕底部（快门按钮上方）
**样式**：细长的灰色槽，中间有白色滑块，中心绿色安全区
**行为**：
- 录制时显示
- 完美状态：滑块在中间绿色区域
- 太快/太抖：滑块冲出安全区变红
- 实时反映运动平滑度和速度一致性

**实现位置**：`ShootingAdvisorView.tsx` - `BalanceMeter` 组件

## 数据流

### 前端状态
- `telemetry`: 实时运动数据（速度、平滑度、方向等）
- `currentTask`: 当前任务状态（任务ID、描述、进度等）
- `currentAdvice`: 实时建议（优先级、消息等）
- `isRecording`: 是否正在录制

### 后端消息类型
- `telemetry`: 遥测数据（每帧分析后发送）
- `task`: 任务状态更新（环境扫描、任务选择、执行进度等）
- `environment`: 环境分析结果（开流时发送）
- `advice`: 实时建议（原有功能）

## 显示逻辑

### 默认显示（无数据时）
- **教练胶囊**：显示"准备开始拍摄"或"保持稳定，跟随引导"
- **方向指示器**：录制时显示默认向右 `>>>`
- **平衡水平仪**：录制时显示，使用默认中间位置

### 有数据时
- **教练胶囊**：显示任务描述或建议消息
- **方向指示器**：根据任务类型和实际运动方向显示，错误时变红
- **平衡水平仪**：根据实际运动数据实时更新位置和颜色

## 测试方法

1. **启动服务**：
   ```bash
   cd story-galaxy-controller
   USE_HTTPS=true ./start.sh
   ```

2. **打开前端**：访问 `https://localhost:3000`

3. **点击"开始分析"**：应该立即看到：
   - 顶部胶囊显示"跟随引导，向右平移"
   - 右侧显示 `>>>`（白色，跳动）
   - 底部显示水平仪（中间位置）

4. **移动手机**：观察水平仪和方向指示器的变化

## 问题排查

### HUD 不显示

1. **检查浏览器控制台**：
   - 打开 F12 → Console
   - 查看是否有错误信息
   - 查看是否有 `telemetry`、`task` 消息

2. **检查数据状态**：
   - 在组件中添加 `console.log` 输出 `telemetry`、`currentTask`、`isRecording`
   - 确认数据是否正确更新

3. **检查 z-index**：
   - HUD 组件使用 `z-[100]`，应该在最上层
   - 如果被遮挡，检查其他元素的 z-index

### 数据不更新

1. **检查 WebSocket 连接**：
   - 确认后端正在运行（端口 8080）
   - 查看浏览器 Network → WS 标签页
   - 确认消息类型是否正确

2. **检查后端日志**：
   - 查看 Node.js 后端是否发送了 `telemetry` 和 `task` 消息
   - 如果使用 Python 后端，确认是否实现了这些消息类型

3. **使用模拟数据**：
   - 代码中已添加模拟数据逻辑（`useEffect`）
   - 录制时如果没有真实数据，会自动创建模拟数据用于显示

## 下一步优化

1. **环境扫描触发**：确保开流时自动触发环境扫描
2. **任务状态机**：完善任务状态流转（ENV_SCAN → TASK_PICKED → EXECUTING → RECOVERY → DONE）
3. **数据同步**：确保后端发送的 `telemetry` 和 `task` 消息格式正确
4. **动画优化**：调整动画效果，使其更符合"原生相机"的感觉

