# 🚀 Intuition-X 项目完整启动攻略

> **最后更新**: 2026-01-02  
> **适用场景**: 本地开发 + 手机访问测试

---

## 📋 目录

1. [系统要求](#系统要求)
2. [前置准备](#前置准备)
3. [配置步骤](#配置步骤)
4. [启动服务](#启动服务)
5. [验证测试](#验证测试)
6. [手机访问配置](#手机访问配置)
7. [常见问题](#常见问题)
8. [服务管理](#服务管理)

---

## 系统要求

### 软件环境

| 软件 | 版本要求 | 用途 |
|------|---------|------|
| **Python** | 3.10+ | 后端服务 |
| **Node.js** | 18+ | 前端服务 |
| **uv** | 最新版 | Python 依赖管理 |
| **mkcert** | 最新版 | HTTPS 证书生成 |
| **Conda** | 可选 | Python 环境管理 |

### 网络要求

- 电脑和手机需在同一 Wi-Fi 网络
- 防火墙允许端口：3000, 8000, 8001

---

## 前置准备

### 1. 安装必要工具

#### macOS

```bash
# 安装 Homebrew（如果未安装）
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# 安装 mkcert（用于生成 HTTPS 证书）
brew install mkcert
mkcert -install

# 安装 uv（Python 依赖管理）
curl -LsSf https://astral.sh/uv/install.sh | sh
source ~/.zshrc
```

#### Linux

```bash
# 安装 mkcert
sudo apt install mkcert  # Ubuntu/Debian
# 或
sudo yum install mkcert  # CentOS/RHEL

mkcert -install

# 安装 uv
curl -LsSf https://astral.sh/uv/install.sh | sh
source ~/.bashrc
```

### 2. 克隆项目（如果尚未克隆）

```bash
git clone <repository-url>
cd Intuition-X
```

### 3. 获取本机 IP 地址

```bash
# macOS/Linux
ifconfig | grep "inet " | grep -v 127.0.0.1 | head -1 | awk '{print $2}'

# 记录下这个 IP 地址，例如：192.168.1.100
# 后续配置会用到
```

**重要**：记录下你的 IP 地址，例如 `192.168.43.226`

---

## 配置步骤

### 步骤 1: 生成 HTTPS 证书

HTTPS 证书用于：
- 前端 HTTPS 访问（浏览器要求）
- Phone AI 后端 WSS 连接（安全 WebSocket）
- 手机摄像头访问（浏览器安全策略）

```bash
cd Intuition-X/frontend

# 创建证书目录
mkdir -p certs

# 获取本机 IP（根据系统选择）
# macOS:
LOCAL_IP=$(ifconfig | grep "inet " | grep -v 127.0.0.1 | head -1 | awk '{print $2}')
# Linux:
# LOCAL_IP=$(ip addr show | grep "inet " | grep -v 127.0.0.1 | head -1 | awk '{print $2}' | cut -d/ -f1)

# 生成证书（包含 localhost 和本机 IP）
mkcert -key-file certs/localhost+3-key.pem \
       -cert-file certs/localhost+3.pem \
       localhost 127.0.0.1 ::1 $LOCAL_IP

# 验证证书已生成
ls -la certs/
```

**预期输出**：
```
-rw------- localhost+3-key.pem
-rw-r--r-- localhost+3.pem
```

### 步骤 2: 配置前端环境变量

创建或更新 `frontend/.env` 文件：

```bash
cd Intuition-X/frontend

# 使用你的实际 IP 替换 YOUR_IP_ADDRESS
cat > .env << 'EOF'
# ========================================
# API 配置
# ========================================

# 替换为你的实际 IP 地址（步骤 3 中获取的）
VITE_API_BASE_URL=http://192.168.43.226:8000/api/v1
VITE_SHOT_ANALYSIS_BASE_URL=http://192.168.43.226:8000

# Phone AI 后端端口
VITE_PHONE_AI_PORT=8001

# API 超时时间（毫秒）
VITE_API_TIMEOUT=30000

# ========================================
# 认证配置
# ========================================

VITE_TOKEN_KEY=rubik_token
VITE_REFRESH_TOKEN_KEY=rubik_refresh_token

# ========================================
# 第三方服务配置
# ========================================

# Google Gemini API Key（如果需要）
VITE_GEMINI_API_KEY=your_gemini_api_key_here

# ========================================
# 功能开关
# ========================================

VITE_ENABLE_MOCK=false
VITE_ENABLE_API_LOG=true

# ========================================
# 业务配置
# ========================================

VITE_FREE_DAILY_QUOTA=5
VITE_MAX_FILE_SIZE=100
VITE_SUPPORTED_VIDEO_FORMATS=mp4,mov,avi,mkv
VITE_POLL_INTERVAL=2000
VITE_MAX_POLL_ATTEMPTS=60
EOF
```

**重要**：将 `192.168.43.226` 替换为你自己的 IP 地址！

### 步骤 3: 配置后端环境变量（可选）

Phone AI 后端的 `.env` 已经配置好，如果需要自定义：

```bash
cd Intuition-X/Backend/phone_ai

# 查看当前配置
cat .env

# 如需修改，编辑此文件
nano .env
```

---

## 启动服务

项目需要启动 **3 个服务**，建议使用 **3 个独立终端**。

### 终端 1: Video AI Demo 后端（Dashboard 数据）

```bash
cd Intuition-X/Backend/video_ai_demo

# 启动服务
./start.sh
```

**预期输出**：
```
===================================
Video AI Demo Backend
===================================

启动服务...
访问 http://localhost:8000 查看服务
访问 http://localhost:8000/docs 查看API文档

INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:     Started server process [xxxxx]
INFO:     Application startup complete.
```

**端口**: 8000  
**协议**: HTTP  
**用途**: Dashboard 统计、视频分析

---

### 终端 2: Phone AI 后端（拍摄辅助）

```bash
cd Intuition-X/Backend/phone_ai

# 设置端口
export PORT=8001

# 使用 UV 启动（推荐）
uv run uvicorn src.api.app:app \
    --host 0.0.0.0 \
    --port 8001 \
    --reload \
    --ssl-keyfile="../../frontend/certs/localhost+3-key.pem" \
    --ssl-certfile="../../frontend/certs/localhost+3.pem"
```

**或使用启动脚本**：
```bash
./start_backend_https.sh
```

**预期输出**：
```
INFO:     Uvicorn running on https://0.0.0.0:8001 (Press CTRL+C to quit)
INFO:     Started reloader process [xxxxx] using StatReload
INFO:     Started server process [xxxxx]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
```

**端口**: 8001  
**协议**: HTTPS (WSS for WebSocket)  
**用途**: 实时拍摄指导、WebSocket 连接

---

### 终端 3: 前端服务

```bash
cd Intuition-X/frontend

# 安装依赖（首次运行）
npm install

# 启动开发服务器
npm run dev
```

**预期输出**：
```
VITE v6.4.1  ready in 121 ms

➜  Local:   https://localhost:3000/
➜  Network: https://192.168.43.226:3000/
➜  Network: https://198.18.0.1:3000/
➜  press h + enter to show help
```

**端口**: 3000  
**协议**: HTTPS  
**用途**: Web 界面

---

## 验证测试

### 1. 检查服务运行状态

在新终端中执行：

```bash
# 检查所有端口
lsof -i:3000,8000,8001

# 或分别检查
lsof -i:3000  # 前端
lsof -i:8000  # video_ai_demo
lsof -i:8001  # Phone AI
```

**预期输出**：应该看到三个服务都在运行

### 2. 测试 API 端点

```bash
# 获取你的 IP（替换下面命令中的 IP）
LOCAL_IP=$(ifconfig | grep "inet " | grep -v 127.0.0.1 | head -1 | awk '{print $2}')

# 测试 Video AI Demo 后端
curl http://${LOCAL_IP}:8000/api/v1/dashboard/stats

# 测试 Phone AI 后端（HTTPS）
curl -k https://${LOCAL_IP}:8001/docs

# 查看前端
curl -k https://${LOCAL_IP}:3000
```

### 3. 浏览器访问测试

#### 电脑浏览器

打开浏览器，访问：

```
https://192.168.43.226:3000/
```

**首次访问证书警告处理**：
- Chrome: 点击"高级" → "继续前往"
- Safari: 点击"显示详情" → "访问此网站"
- Firefox: 点击"高级" → "接受风险并继续"

**验证清单**：
- [ ] 页面正常加载
- [ ] Dashboard 显示统计数据（不报错）
- [ ] 可以切换到不同页面
- [ ] 浏览器控制台无重大错误

---

## 手机访问配置

### 方法 1: 扫描二维码（推荐）

1. **在电脑浏览器访问**：
   ```
   https://192.168.43.226:3000/
   ```

2. **进入拍摄页面**：
   - 点击侧边栏的 "Phone AI" 或 "Shooting" 相关菜单
   - 页面会显示二维码

3. **用手机扫描二维码**：
   - 使用手机相机或微信扫一扫
   - 点击打开链接

### 方法 2: 手动输入 URL

在手机浏览器（Safari/Chrome）中输入：

```
https://192.168.43.226:3000/
```

**将 IP 替换为你的实际 IP！**

### 手机端首次访问

#### iOS (Safari)

1. 访问 URL 后显示证书警告
2. 点击"显示详情"
3. 点击"访问此网站"
4. 输入手机密码确认
5. 页面加载成功

#### Android (Chrome)

1. 访问 URL 后显示"您的连接不是私密连接"
2. 点击"高级"
3. 点击"继续前往 192.168.43.226（不安全）"
4. 页面加载成功

### 允许摄像头权限

拍摄页面会请求摄像头权限：
- 点击"允许"或"Allow"
- 如果误点拒绝，在浏览器设置中重新授权

---

## 常见问题

### Q1: 手机显示 "CONNECTION_REFUSED"

**原因**：URL 中包含 `localhost` 或服务未运行

**解决**：
1. 确认使用 IP 地址而非 localhost
2. 检查服务是否都在运行：
   ```bash
   lsof -i:3000,8000,8001
   ```
3. 确认手机和电脑在同一 Wi-Fi

### Q2: Dashboard 显示"网络连接失败"

**原因**：video_ai_demo 后端未运行或 `.env` 配置错误

**解决**：
1. 检查 8000 端口服务：
   ```bash
   lsof -i:8000
   ```
2. 检查 `frontend/.env` 中的 `VITE_API_BASE_URL`
3. 重启前端服务

### Q3: WebSocket 连接失败（Mixed Content 错误）

**错误信息**：
```
Mixed Content: The page at 'https://...' was loaded over HTTPS,
but attempted to connect to the insecure WebSocket endpoint 'ws://...'
```

**原因**：Phone AI 后端未使用 HTTPS

**解决**：
确保 Phone AI 后端使用 HTTPS 启动（参考"启动服务 - 终端 2"）

### Q4: 手机无法访问摄像头

**原因**：浏览器安全策略限制

**解决**：
1. 确保使用 HTTPS（不是 HTTP）
2. 在浏览器设置中允许摄像头权限
3. iOS 推荐使用 Safari，Android 推荐使用 Chrome

### Q5: 证书生成失败

**错误信息**：
```
ERROR: mkcert is not installed
```

**解决**：
```bash
# macOS
brew install mkcert

# Linux
sudo apt install mkcert

# 安装 CA
mkcert -install
```

### Q6: 端口被占用

**错误信息**：
```
ERROR: [Errno 48] Address already in use
```

**解决**：
```bash
# 查找占用端口的进程
lsof -ti:8001

# 杀死进程（替换 PID）
kill <PID>

# 或强制杀死
kill -9 <PID>
```

### Q7: 前端连接后端失败（CORS 错误）

**解决**：
确认后端已正确配置 CORS，video_ai_demo 和 Phone AI 都已处理

### Q8: uv 命令未找到

**解决**：
```bash
# 安装 uv
curl -LsSf https://astral.sh/uv/install.sh | sh

# 刷新环境
source ~/.zshrc  # macOS
# 或
source ~/.bashrc  # Linux
```

---

## 服务管理

### 快速启动脚本

创建 `start_all.sh`：

```bash
#!/bin/bash

echo "🚀 启动 Intuition-X 项目..."
echo ""

# 获取 IP
LOCAL_IP=$(ifconfig | grep "inet " | grep -v 127.0.0.1 | head -1 | awk '{print $2}')
echo "📍 本机 IP: $LOCAL_IP"
echo ""

# 启动 video_ai_demo（后台）
echo "▶️  启动 Video AI Demo 后端 (8000)..."
cd Backend/video_ai_demo
./start.sh > /tmp/video_ai_demo.log 2>&1 &
cd ../..
sleep 3

# 启动 Phone AI（后台）
echo "▶️  启动 Phone AI 后端 (8001)..."
cd Backend/phone_ai
export PORT=8001
uv run uvicorn src.api.app:app \
    --host 0.0.0.0 \
    --port 8001 \
    --reload \
    --ssl-keyfile="../../frontend/certs/localhost+3-key.pem" \
    --ssl-certfile="../../frontend/certs/localhost+3.pem" \
    > /tmp/phone_ai.log 2>&1 &
cd ../..
sleep 3

# 启动前端（后台）
echo "▶️  启动前端服务 (3000)..."
cd frontend
npm run dev > /tmp/frontend.log 2>&1 &
cd ..

echo ""
echo "✅ 所有服务已启动！"
echo ""
echo "访问地址："
echo "  电脑: https://$LOCAL_IP:3000/"
echo "  手机: https://$LOCAL_IP:3000/ (扫码)"
echo ""
echo "查看日志："
echo "  tail -f /tmp/video_ai_demo.log"
echo "  tail -f /tmp/phone_ai.log"
echo "  tail -f /tmp/frontend.log"
```

### 停止所有服务

创建 `stop_all.sh`：

```bash
#!/bin/bash

echo "🛑 停止所有服务..."

# 停止各端口的服务
lsof -ti:3000 | xargs kill -9 2>/dev/null
lsof -ti:8000 | xargs kill -9 2>/dev/null
lsof -ti:8001 | xargs kill -9 2>/dev/null

echo "✅ 所有服务已停止"
```

### 查看服务状态

创建 `status.sh`：

```bash
#!/bin/bash

echo "📊 服务状态检查"
echo ""

check_port() {
    PORT=$1
    NAME=$2
    if lsof -i:$PORT > /dev/null 2>&1; then
        echo "✅ $NAME (端口 $PORT): 运行中"
    else
        echo "❌ $NAME (端口 $PORT): 未运行"
    fi
}

check_port 3000 "前端"
check_port 8000 "Video AI Demo"
check_port 8001 "Phone AI"

echo ""
LOCAL_IP=$(ifconfig | grep "inet " | grep -v 127.0.0.1 | head -1 | awk '{print $2}')
echo "📍 访问地址: https://$LOCAL_IP:3000/"
```

---

## 架构图

```
┌─────────────────────────────────────────────────────────┐
│                    客户端访问                              │
├───────────────┬─────────────────────────────────────────┤
│  电脑浏览器    │  手机浏览器                               │
│  Chrome/Safari│  Safari/Chrome                           │
└───────┬───────┴──────────┬──────────────────────────────┘
        │                  │
        │ HTTPS (3000)     │ HTTPS (3000)
        │                  │
        └──────────┬───────┘
                   ▼
        ┌─────────────────────┐
        │   Vite 前端服务       │
        │   (Port 3000)       │
        │   HTTPS             │
        └──────┬─────┬────────┘
               │     │
    HTTP (8000)│     │ WSS (8001)
               │     │
        ┌──────▼─────▼────────┐
        │                     │
  ┌─────▼──────┐      ┌──────▼──────┐
  │Video AI Demo│      │  Phone AI   │
  │  Backend   │      │   Backend   │
  │ (Port 8000)│      │ (Port 8001) │
  │   HTTP     │      │   HTTPS     │
  └────────────┘      └─────────────┘
       │                      │
       │ Dashboard API        │ WebSocket (WSS)
       │ 视频分析 API         │ 实时拍摄指导
       │                      │
  ┌────▼──────────────────────▼────┐
  │        数据存储 & 服务           │
  │  - SQLite (video_ai_demo)     │
  │  - 内存存储 (Phone AI)         │
  │  - 文件系统 (视频/图片)         │
  └───────────────────────────────┘
```

---

## 开发工作流

### 日常启动流程

1. **打开 3 个终端窗口**
2. **启动服务**（按顺序）：
   - 终端 1: video_ai_demo
   - 终端 2: Phone AI
   - 终端 3: 前端
3. **验证访问**：
   - 电脑: `https://192.168.43.226:3000/`
4. **开发调试**：
   - 修改代码自动热重载
   - 查看终端日志
5. **测试手机访问**：
   - 扫码或输入 URL

### 代码修改后

- **前端**: 自动热重载，无需重启
- **后端**: 自动重载（`--reload` 参数）
- **.env 修改**: 需重启前端

---

## 生产环境部署

> 注意：本指南主要针对本地开发，生产环境需要额外配置

### 需要修改的地方

1. **使用正式域名和 SSL 证书**（如 Let's Encrypt）
2. **配置反向代理**（Nginx/Caddy）
3. **使用生产环境数据库**（PostgreSQL）
4. **配置环境变量**（生产 API 地址）
5. **启用日志系统**
6. **配置监控和告警**

---

## 技术栈

| 组件 | 技术 | 说明 |
|------|------|------|
| 前端框架 | React + TypeScript | Vite 构建 |
| 前端样式 | Tailwind CSS | 响应式设计 |
| 后端框架 | FastAPI | Python 异步框架 |
| 实时通信 | WebSocket (WSS) | 双向通信 |
| 数据库 | SQLite | 本地存储 |
| 依赖管理 | uv (Python), npm (Node) | |
| HTTPS | mkcert | 本地证书 |

---

## 项目结构

```
Intuition-X/
├── frontend/                    # 前端代码
│   ├── components/             # React 组件
│   ├── services/               # API 服务
│   ├── certs/                  # HTTPS 证书
│   ├── .env                    # 环境变量
│   └── vite.config.ts          # Vite 配置
│
├── Backend/
│   ├── video_ai_demo/          # Dashboard 后端
│   │   ├── app/                # 应用代码
│   │   ├── data/               # 数据存储
│   │   └── start.sh            # 启动脚本
│   │
│   └── phone_ai/               # 拍摄辅助后端
│       ├── src/                # 源代码
│       ├── .env                # 环境变量
│       └── start_backend_https.sh
│
└── [本文档]                    # 启动攻略
```

---

## 相关文档

- [README.md](./README.md) - 项目总览
- [HTTPS_SETUP.md](./HTTPS_SETUP.md) - HTTPS 详细配置
- [frontend/README.md](./frontend/README.md) - 前端文档
- [Backend/phone_ai/README.md](./Backend/phone_ai/README.md) - Phone AI 文档

---

## 贡献与支持

如遇到问题：
1. 查看本文档的"常见问题"部分
2. 检查各终端的日志输出
3. 查看浏览器开发者工具控制台

---

**祝你开发顺利！** 🎉

如有问题，请检查：
- [ ] 所有服务都在运行
- [ ] IP 地址配置正确
- [ ] 证书已正确生成
- [ ] 手机和电脑在同一网络
- [ ] 防火墙未阻止端口

